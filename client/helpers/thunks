import axios from "axios";

export const getAudioThunk = (word) => async (dispatch) => {
  const response = await axios.post("/api/audio", { word });
  const audio = response.data.audioContent.data;
  if (audio.length === 0) {
    return;
  }
  const context = new window.AudioContext;

  function playByteArray(bytes) {
    var buffer = new Uint8Array(bytes.length);
    buffer.set(new Uint8Array(bytes), 0);
    context.decodeAudioData(buffer.buffer, play);
  }

  function play(audioBuffer) {
    var source = context.createBufferSource();
    source.buffer = audioBuffer;
    source.connect(context.destination);
    source.start(0);
  }

  playByteArray(audio);

  return response.data;
};